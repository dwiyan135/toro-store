{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/toro-store-app/src/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport type { NextRequest } from 'next/server';\r\nimport { jwtVerify } from 'jose';\r\n\r\nconst secret = new TextEncoder().encode(\r\n  process.env.ADMIN_PASSWORD || 'admin_toro_fallback_secret_key'\r\n);\r\n\r\nexport async function middleware(request: NextRequest) {\r\n  if (request.nextUrl.pathname.startsWith('/admin') && !request.nextUrl.pathname.startsWith('/admin/login')) {\r\n    const token = request.cookies.get('admin_session')?.value;\r\n\r\n    if (!token) {\r\n      return NextResponse.redirect(new URL('/admin/login', request.url));\r\n    }\r\n\r\n    try {\r\n      await jwtVerify(token, secret);\r\n      return NextResponse.next();\r\n    } catch {\r\n      return NextResponse.redirect(new URL('/admin/login', request.url));\r\n    }\r\n  }\r\n\r\n  // Prevent logged in users from seeing login page\r\n  if (request.nextUrl.pathname.startsWith('/admin/login')) {\r\n    const token = request.cookies.get('admin_session')?.value;\r\n    if (token) {\r\n      try {\r\n        await jwtVerify(token, secret);\r\n        return NextResponse.redirect(new URL('/admin', request.url));\r\n      } catch {\r\n        // continue to login\r\n      }\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: '/admin/:path*',\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CACrC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAGzB,eAAe,WAAW,OAAoB;IACnD,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,iBAAiB;QACzG,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;QAEpD,IAAI,CAAC,OAAO;YACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;QAEA,IAAI;YACF,MAAM,IAAA,4KAAS,EAAC,OAAO;YACvB,OAAO,gMAAY,CAAC,IAAI;QAC1B,EAAE,OAAM;YACN,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,gBAAgB,QAAQ,GAAG;QAClE;IACF;IAEA,iDAAiD;IACjD,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,iBAAiB;QACvD,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,kBAAkB;QACpD,IAAI,OAAO;YACT,IAAI;gBACF,MAAM,IAAA,4KAAS,EAAC,OAAO;gBACvB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;YAC5D,EAAE,OAAM;YACN,oBAAoB;YACtB;QACF;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;AACX"}}]
}