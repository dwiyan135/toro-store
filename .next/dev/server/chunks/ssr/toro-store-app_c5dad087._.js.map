{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/auth.ts"],"sourcesContent":["'use server';\r\n\r\nimport { SignJWT } from 'jose';\r\nimport { cookies } from 'next/headers';\r\n\r\nconst secret = new TextEncoder().encode(\r\n  process.env.ADMIN_PASSWORD || 'admin_toro_fallback_secret_key'\r\n);\r\n\r\nexport async function login(password: string) {\r\n  const adminPassword = process.env.ADMIN_PASSWORD || 'admin_toro';\r\n\r\n  if (password !== adminPassword) {\r\n    return { error: 'Password salah' };\r\n  }\r\n\r\n  // Create JWT token using edge-compatible formatting\r\n  const token = await new SignJWT({ admin: true })\r\n    .setProtectedHeader({ alg: 'HS256' })\r\n    .setIssuedAt()\r\n    .setExpirationTime('24h') // Set 24 hour session\r\n    .sign(secret);\r\n\r\n  const cookieStore = await cookies();\r\n  cookieStore.set('admin_session', token, {\r\n    httpOnly: true,\r\n    secure: process.env.NODE_ENV === 'production',\r\n    sameSite: 'lax',\r\n    path: '/admin', // Scope to admin area\r\n    maxAge: 60 * 60 * 24, // 24 hours\r\n  });\r\n\r\n  return { success: true };\r\n}\r\n\r\nexport async function logout() {\r\n  const cookieStore = await cookies();\r\n  cookieStore.delete('admin_session');\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CACrC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAGzB,eAAe,MAAM,QAAgB;IAC1C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IAEpD,IAAI,aAAa,eAAe;QAC9B,OAAO;YAAE,OAAO;QAAiB;IACnC;IAEA,oDAAoD;IACpD,MAAM,QAAQ,MAAM,IAAI,gKAAO,CAAC;QAAE,OAAO;IAAK,GAC3C,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,OAAO,sBAAsB;KAC/C,IAAI,CAAC;IAER,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,iBAAiB,OAAO;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IAEA,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB;;;IA7BsB;IA0BA;;AA1BA,+OAAA;AA0BA,+OAAA"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/stock.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function getStock() {\r\n  try {\r\n    const stock = await prisma.stockSetting.findFirst();\r\n    if (!stock) {\r\n      // Return defaults if none exists\r\n      return { basicStock: 0, premiumStock: 0, specialStock: 0 };\r\n    }\r\n    return stock;\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch stock:\", error);\r\n    return { basicStock: 0, premiumStock: 0, specialStock: 0 };\r\n  }\r\n}\r\n\r\nexport async function updateStock(basic: number, premium: number, special: number) {\r\n  try {\r\n    const existing = await prisma.stockSetting.findFirst();\r\n    if (existing) {\r\n      await prisma.stockSetting.update({\r\n        where: { id: existing.id },\r\n        data: {\r\n          basicStock: basic,\r\n          premiumStock: premium,\r\n          specialStock: special,\r\n        }\r\n      });\r\n    } else {\r\n      await prisma.stockSetting.create({\r\n        data: {\r\n          basicStock: basic,\r\n          premiumStock: premium,\r\n          specialStock: special,\r\n        }\r\n      });\r\n    }\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/stock');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Failed to update stock:\", error);\r\n    return { success: false, error: \"Gagal mengupdate stok.\" };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,QAAQ,MAAM,sJAAM,CAAC,YAAY,CAAC,SAAS;QACjD,IAAI,CAAC,OAAO;YACV,iCAAiC;YACjC,OAAO;gBAAE,YAAY;gBAAG,cAAc;gBAAG,cAAc;YAAE;QAC3D;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;YAAE,YAAY;YAAG,cAAc;YAAG,cAAc;QAAE;IAC3D;AACF;AAEO,eAAe,YAAY,KAAa,EAAE,OAAe,EAAE,OAAe;IAC/E,IAAI;QACF,MAAM,WAAW,MAAM,sJAAM,CAAC,YAAY,CAAC,SAAS;QACpD,IAAI,UAAU;YACZ,MAAM,sJAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC/B,OAAO;oBAAE,IAAI,SAAS,EAAE;gBAAC;gBACzB,MAAM;oBACJ,YAAY;oBACZ,cAAc;oBACd,cAAc;gBAChB;YACF;QACF,OAAO;YACL,MAAM,sJAAM,CAAC,YAAY,CAAC,MAAM,CAAC;gBAC/B,MAAM;oBACJ,YAAY;oBACZ,cAAc;oBACd,cAAc;gBAChB;YACF;QACF;QACA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyB;IAC3D;AACF;;;IA1CsB;IAcA;;AAdA,+OAAA;AAcA,+OAAA"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/order.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { getStock } from './stock';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function createOrder(data: {\r\n  packageType: 'BASIC' | 'PREMIUM' | 'SPECIAL';\r\n  itemName: string;\r\n  mlbbId: string;\r\n  serverId: string;\r\n  nickname?: string;\r\n  note?: string;\r\n  waNumber?: string;\r\n}) {\r\n  try {\r\n    // 1. Verify stock\r\n    const stock = await getStock();\r\n    \r\n    let isAvailable = false;\r\n    if (data.packageType === 'BASIC' && stock.basicStock > 0) isAvailable = true;\r\n    if (data.packageType === 'PREMIUM' && stock.premiumStock > 0) isAvailable = true;\r\n    if (data.packageType === 'SPECIAL' && stock.specialStock > 0) isAvailable = true;\r\n\r\n    if (!isAvailable) {\r\n      return { success: false, error: 'Stok Habis' };\r\n    }\r\n\r\n    // 2. Generate unique order code (TS-YYYY-RND4)\r\n    const year = new Date().getFullYear();\r\n    const rnd = Math.floor(1000 + Math.random() * 9000);\r\n    const orderCode = `TS-${year}-${rnd}`;\r\n\r\n    // 3. Save order to database\r\n    const order = await prisma.order.create({\r\n      data: {\r\n        orderCode,\r\n        packageType: data.packageType,\r\n        itemName: data.itemName,\r\n        mlbbId: data.mlbbId,\r\n        serverId: data.serverId,\r\n        nickname: data.nickname,\r\n        note: data.note,\r\n        waNumber: data.waNumber,\r\n        status: 'NEW',\r\n        events: {\r\n          create: {\r\n            eventType: 'ORDER_CREATED',\r\n            message: 'Order placed by user',\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    return { success: true, orderCode: order.orderCode };\r\n  } catch (error) {\r\n    console.error(\"Failed to create order:\", error);\r\n    return { success: false, error: 'Terjadi kesalahan sistem.' };\r\n  }\r\n}\r\n\r\nexport async function getAdminOrders() {\r\n  try {\r\n    const orders = await prisma.order.findMany({\r\n      orderBy: { createdAt: 'desc' },\r\n      take: 100\r\n    });\r\n    return orders;\r\n  } catch (error) {\r\n    console.error(\"Failed to fetch admin orders:\", error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function updateOrderStatus(orderId: string, newStatus: 'NEW' | 'CONFIRMED' | 'DONE' | 'CANCELED') {\r\n  try {\r\n    await prisma.order.update({\r\n      where: { id: orderId },\r\n      data: { status: newStatus },\r\n    });\r\n    \r\n    await prisma.orderEvent.create({\r\n      data: {\r\n        orderId: orderId,\r\n        eventType: 'STATUS_UPDATED',\r\n        message: `Status diubah menjadi ${newStatus}`,\r\n      }\r\n    });\r\n\r\n    revalidatePath('/admin');\r\n    revalidatePath('/admin/orders');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Failed to update status:\", error);\r\n    return { success: false, error: 'Gagal mengupdate status' };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;AACA;;;;;;AAEO,eAAe,YAAY,IAQjC;IACC,IAAI;QACF,kBAAkB;QAClB,MAAM,QAAQ,MAAM,IAAA,2JAAQ;QAE5B,IAAI,cAAc;QAClB,IAAI,KAAK,WAAW,KAAK,WAAW,MAAM,UAAU,GAAG,GAAG,cAAc;QACxE,IAAI,KAAK,WAAW,KAAK,aAAa,MAAM,YAAY,GAAG,GAAG,cAAc;QAC5E,IAAI,KAAK,WAAW,KAAK,aAAa,MAAM,YAAY,GAAG,GAAG,cAAc;QAE5E,IAAI,CAAC,aAAa;YAChB,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAa;QAC/C;QAEA,+CAA+C;QAC/C,MAAM,OAAO,IAAI,OAAO,WAAW;QACnC,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO,KAAK,MAAM,KAAK;QAC9C,MAAM,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,KAAK;QAErC,4BAA4B;QAC5B,MAAM,QAAQ,MAAM,sJAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACtC,MAAM;gBACJ;gBACA,aAAa,KAAK,WAAW;gBAC7B,UAAU,KAAK,QAAQ;gBACvB,QAAQ,KAAK,MAAM;gBACnB,UAAU,KAAK,QAAQ;gBACvB,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,UAAU,KAAK,QAAQ;gBACvB,QAAQ;gBACR,QAAQ;oBACN,QAAQ;wBACN,WAAW;wBACX,SAAS;oBACX;gBACF;YACF;QACF;QAEA,OAAO;YAAE,SAAS;YAAM,WAAW,MAAM,SAAS;QAAC;IACrD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,sJAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACzC,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;QACR;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,EAAE;IACX;AACF;AAEO,eAAe,kBAAkB,OAAe,EAAE,SAAoD;IAC3G,IAAI;QACF,MAAM,sJAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACxB,OAAO;gBAAE,IAAI;YAAQ;YACrB,MAAM;gBAAE,QAAQ;YAAU;QAC5B;QAEA,MAAM,sJAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAC7B,MAAM;gBACJ,SAAS;gBACT,WAAW;gBACX,SAAS,CAAC,sBAAsB,EAAE,WAAW;YAC/C;QACF;QAEA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA0B;IAC5D;AACF;;;IA1FsB;IAuDA;IAaA;;AApEA,+OAAA;AAuDA,+OAAA;AAaA,+OAAA"}},
    {"offset": {"line": 283, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/.next-internal/server/app/admin/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '00dc57a7e72aa127a22f927d7f8e3616ac24788e84'} from 'ACTIONS_MODULE0'\nexport {getAdminOrders as '00986472927b213c1b5796c3ffe41b461afec1415a'} from 'ACTIONS_MODULE1'\nexport {createOrder as '406c58de2a8d107d69f717d1ea428917143219f5a2'} from 'ACTIONS_MODULE1'\nexport {updateOrderStatus as '60bcc6ce0e61c46f6b09126728ced90dd495cd3557'} from 'ACTIONS_MODULE1'\nexport {getStock as '0098025e53e760b149d81cf395544af6bbd34edbcf'} from 'ACTIONS_MODULE2'\nexport {updateStock as '708273d5d05c59318d87f9c62b0b03739e1fe33178'} from 'ACTIONS_MODULE2'\n"],"names":[],"mappings":";AAAA;AACA;AAGA"}}]
}