{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/auth.ts"],"sourcesContent":["'use server';\r\n\r\nimport { SignJWT } from 'jose';\r\nimport { cookies } from 'next/headers';\r\n\r\nconst secret = new TextEncoder().encode(\r\n  process.env.ADMIN_PASSWORD || 'admin_toro_fallback_secret_key'\r\n);\r\n\r\nexport async function login(password: string) {\r\n  const adminPassword = process.env.ADMIN_PASSWORD || 'admin_toro';\r\n\r\n  if (password !== adminPassword) {\r\n    return { error: 'Password salah' };\r\n  }\r\n\r\n  // Create JWT token using edge-compatible formatting\r\n  const token = await new SignJWT({ admin: true })\r\n    .setProtectedHeader({ alg: 'HS256' })\r\n    .setIssuedAt()\r\n    .setExpirationTime('24h') // Set 24 hour session\r\n    .sign(secret);\r\n\r\n  const cookieStore = await cookies();\r\n  cookieStore.set('admin_session', token, {\r\n    httpOnly: true,\r\n    secure: process.env.NODE_ENV === 'production',\r\n    sameSite: 'lax',\r\n    path: '/admin', // Scope to admin area\r\n    maxAge: 60 * 60 * 24, // 24 hours\r\n  });\r\n\r\n  return { success: true };\r\n}\r\n\r\nexport async function logout() {\r\n  const cookieStore = await cookies();\r\n  cookieStore.delete('admin_session');\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,cAAc,MAAM,CACrC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAGzB,eAAe,MAAM,QAAgB;IAC1C,MAAM,gBAAgB,QAAQ,GAAG,CAAC,cAAc,IAAI;IAEpD,IAAI,aAAa,eAAe;QAC9B,OAAO;YAAE,OAAO;QAAiB;IACnC;IAEA,oDAAoD;IACpD,MAAM,QAAQ,MAAM,IAAI,gKAAO,CAAC;QAAE,OAAO;IAAK,GAC3C,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,OAAO,sBAAsB;KAC/C,IAAI,CAAC;IAER,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,GAAG,CAAC,iBAAiB,OAAO;QACtC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK;IACpB;IAEA,OAAO;QAAE,SAAS;IAAK;AACzB;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,0IAAO;IACjC,YAAY,MAAM,CAAC;AACrB;;;IA7BsB;IA0BA;;AA1BA,+OAAA;AA0BA,+OAAA"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 90, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/package.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile, mkdir } from 'fs/promises';\r\nimport { existsSync } from 'fs';\r\nimport path from 'path';\r\nimport sharp from 'sharp';\r\n\r\nfunction getPublicDir(): string {\r\n  const subDirCandidate = path.join(process.cwd(), 'toro-store-app', 'public');\r\n  if (existsSync(subDirCandidate)) return subDirCandidate;\r\n  return path.join(process.cwd(), 'public');\r\n}\r\n\r\nexport async function getPackages() {\r\n  try {\r\n    return await prisma.package.findMany({\r\n      where: { isActive: true },\r\n      orderBy: [{ sortOrder: 'asc' }, { createdAt: 'asc' }],\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to fetch packages:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getAdminPackages() {\r\n  try {\r\n    return await prisma.package.findMany({\r\n      orderBy: [{ sortOrder: 'asc' }, { createdAt: 'asc' }],\r\n      include: { _count: { select: { orders: true } } },\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to fetch admin packages:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getPackageById(id: string) {\r\n  try {\r\n    return await prisma.package.findUnique({ where: { id } });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createPackage(data: {\r\n  name: string;\r\n  description?: string;\r\n  price: string;\r\n  category: string;\r\n  imageUrl?: string;\r\n  stock: number;\r\n  isActive: boolean;\r\n  sortOrder: number;\r\n}) {\r\n  try {\r\n    await prisma.package.create({ data });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to create package:', error);\r\n    return { success: false, error: 'Gagal membuat paket.' };\r\n  }\r\n}\r\n\r\nexport async function updatePackage(\r\n  id: string,\r\n  data: {\r\n    name?: string;\r\n    description?: string;\r\n    price?: string;\r\n    category?: string;\r\n    imageUrl?: string;\r\n    stock?: number;\r\n    isActive?: boolean;\r\n    sortOrder?: number;\r\n  }\r\n) {\r\n  try {\r\n    await prisma.package.update({ where: { id }, data });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to update package:', error);\r\n    return { success: false, error: 'Gagal mengupdate paket.' };\r\n  }\r\n}\r\n\r\nexport async function deletePackage(id: string) {\r\n  try {\r\n    // Delete order events first, then orders, then package (cascade)\r\n    const orders = await prisma.order.findMany({ where: { packageId: id }, select: { id: true } });\r\n    const orderIds = orders.map(o => o.id);\r\n    if (orderIds.length > 0) {\r\n      await prisma.orderEvent.deleteMany({ where: { orderId: { in: orderIds } } });\r\n      await prisma.order.deleteMany({ where: { id: { in: orderIds } } });\r\n    }\r\n    await prisma.package.delete({ where: { id } });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    revalidatePath('/admin');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to delete package:', error);\r\n    return { success: false, error: 'Gagal menghapus paket.' };\r\n  }\r\n}\r\n\r\nexport async function bulkDeletePackages(ids: string[]) {\r\n  try {\r\n    const orders = await prisma.order.findMany({ where: { packageId: { in: ids } }, select: { id: true } });\r\n    const orderIds = orders.map(o => o.id);\r\n    if (orderIds.length > 0) {\r\n      await prisma.orderEvent.deleteMany({ where: { orderId: { in: orderIds } } });\r\n      await prisma.order.deleteMany({ where: { id: { in: orderIds } } });\r\n    }\r\n    await prisma.package.deleteMany({ where: { id: { in: ids } } });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    revalidatePath('/admin');\r\n    return { success: true, count: ids.length };\r\n  } catch (error) {\r\n    console.error('Failed to bulk delete:', error);\r\n    return { success: false, error: 'Gagal menghapus paket.' };\r\n  }\r\n}\r\n\r\nexport async function bulkUpdatePackages(ids: string[], data: { isActive?: boolean }) {\r\n  try {\r\n    await prisma.package.updateMany({ where: { id: { in: ids } }, data });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true, count: ids.length };\r\n  } catch (error) {\r\n    console.error('Failed to bulk update:', error);\r\n    return { success: false, error: 'Gagal mengupdate paket.' };\r\n  }\r\n}\r\n\r\nexport async function uploadPackageImage(formData: FormData): Promise<{ success: boolean; url?: string; error?: string }> {\r\n  try {\r\n    const file = formData.get('file') as File;\r\n    if (!file || file.size === 0) return { success: false, error: 'File tidak ditemukan.' };\r\n\r\n    const allowed = ['image/jpeg', 'image/png', 'image/webp', 'image/gif', 'image/avif'];\r\n    if (!allowed.includes(file.type)) return { success: false, error: 'Format tidak didukung. Gunakan JPG, PNG, atau WebP.' };\r\n\r\n    if (file.size > 10 * 1024 * 1024) return { success: false, error: 'Ukuran file maksimal 10MB.' };\r\n\r\n    const inputBuffer = Buffer.from(await file.arrayBuffer());\r\n    const webpBuffer = await sharp(inputBuffer)\r\n      .resize(1200, 900, { fit: 'inside', withoutEnlargement: true })\r\n      .webp({ quality: 82 })\r\n      .toBuffer();\r\n\r\n    const filename = `pkg_${Date.now()}.webp`;\r\n    const uploadDir = path.join(getPublicDir(), 'uploads');\r\n    await mkdir(uploadDir, { recursive: true });\r\n    await writeFile(path.join(uploadDir, filename), webpBuffer);\r\n\r\n    return { success: true, url: `/uploads/${filename}` };\r\n  } catch (error) {\r\n    console.error('Upload failed:', error);\r\n    return { success: false, error: 'Upload gagal.' };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/.next-internal/server/app/admin/packages/%5Bid%5D/edit/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '00dc57a7e72aa127a22f927d7f8e3616ac24788e84'} from 'ACTIONS_MODULE0'\nexport {getPackageById as '40f4f4146cd83415bebeb3f517dc6d4627eaeb8968'} from 'ACTIONS_MODULE1'\nexport {updatePackage as '6029374c54c1d2c90afebf9ef02b1f378482fc4c3d'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AACA"}}]
}