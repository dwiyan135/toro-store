{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client';\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined;\r\n};\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  });\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAIjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,sMAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 29, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/package.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { writeFile, mkdir } from 'fs/promises';\r\nimport path from 'path';\r\n\r\nexport async function getPackages() {\r\n  try {\r\n    return await prisma.package.findMany({\r\n      where: { isActive: true },\r\n      orderBy: [{ sortOrder: 'asc' }, { createdAt: 'asc' }],\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to fetch packages:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getAdminPackages() {\r\n  try {\r\n    return await prisma.package.findMany({\r\n      orderBy: [{ sortOrder: 'asc' }, { createdAt: 'asc' }],\r\n      include: { _count: { select: { orders: true } } },\r\n    });\r\n  } catch (error) {\r\n    console.error('Failed to fetch admin packages:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function getPackageById(id: string) {\r\n  try {\r\n    return await prisma.package.findUnique({ where: { id } });\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function createPackage(data: {\r\n  name: string;\r\n  description?: string;\r\n  price: string;\r\n  category: string;\r\n  imageUrl?: string;\r\n  stock: number;\r\n  isActive: boolean;\r\n  sortOrder: number;\r\n}) {\r\n  try {\r\n    await prisma.package.create({ data });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to create package:', error);\r\n    return { success: false, error: 'Gagal membuat paket.' };\r\n  }\r\n}\r\n\r\nexport async function updatePackage(\r\n  id: string,\r\n  data: {\r\n    name?: string;\r\n    description?: string;\r\n    price?: string;\r\n    category?: string;\r\n    imageUrl?: string;\r\n    stock?: number;\r\n    isActive?: boolean;\r\n    sortOrder?: number;\r\n  }\r\n) {\r\n  try {\r\n    await prisma.package.update({ where: { id }, data });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to update package:', error);\r\n    return { success: false, error: 'Gagal mengupdate paket.' };\r\n  }\r\n}\r\n\r\nexport async function deletePackage(id: string) {\r\n  try {\r\n    await prisma.package.delete({ where: { id } });\r\n    revalidatePath('/');\r\n    revalidatePath('/admin/packages');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to delete package:', error);\r\n    return { success: false, error: 'Gagal menghapus paket. Mungkin masih ada order terkait.' };\r\n  }\r\n}\r\n\r\nexport async function uploadPackageImage(formData: FormData): Promise<{ success: boolean; url?: string; error?: string }> {\r\n  try {\r\n    const file = formData.get('file') as File;\r\n    if (!file || file.size === 0) return { success: false, error: 'File tidak ditemukan.' };\r\n\r\n    const allowed = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n    if (!allowed.includes(file.type)) return { success: false, error: 'Format tidak didukung. Gunakan JPG, PNG, atau WebP.' };\r\n\r\n    if (file.size > 5 * 1024 * 1024) return { success: false, error: 'Ukuran file maksimal 5MB.' };\r\n\r\n    const ext = file.name.split('.').pop();\r\n    const filename = `pkg_${Date.now()}.${ext}`;\r\n    const uploadDir = path.join(process.cwd(), 'public', 'uploads');\r\n    await mkdir(uploadDir, { recursive: true });\r\n\r\n    const buffer = Buffer.from(await file.arrayBuffer());\r\n    await writeFile(path.join(uploadDir, filename), buffer);\r\n\r\n    return { success: true, url: `/uploads/${filename}` };\r\n  } catch (error) {\r\n    console.error('Upload failed:', error);\r\n    return { success: false, error: 'Upload gagal.' };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/src/actions/order.ts"],"sourcesContent":["'use server';\r\n\r\nimport { prisma } from '@/lib/prisma';\r\nimport { revalidatePath } from 'next/cache';\r\n\r\nexport async function createOrder(data: {\r\n  packageId: string;\r\n  itemName: string;\r\n  mlbbId: string;\r\n  serverId: string;\r\n  nickname?: string;\r\n  note?: string;\r\n  waNumber?: string;\r\n}) {\r\n  try {\r\n    // 1. Verify package exists and has stock\r\n    const pkg = await prisma.package.findUnique({ where: { id: data.packageId } });\r\n    if (!pkg) return { success: false, error: 'Paket tidak ditemukan.' };\r\n    if (!pkg.isActive) return { success: false, error: 'Paket tidak aktif.' };\r\n    if (pkg.stock <= 0) return { success: false, error: 'Stok habis.' };\r\n\r\n    // 2. Generate unique order code (TS-YYYY-RND4)\r\n    const year = new Date().getFullYear();\r\n    const rnd = Math.floor(1000 + Math.random() * 9000);\r\n    const orderCode = `TS-${year}-${rnd}`;\r\n\r\n    // 3. Save order to database\r\n    const order = await prisma.order.create({\r\n      data: {\r\n        orderCode,\r\n        packageId: data.packageId,\r\n        itemName: data.itemName,\r\n        mlbbId: data.mlbbId,\r\n        serverId: data.serverId,\r\n        nickname: data.nickname,\r\n        note: data.note,\r\n        waNumber: data.waNumber,\r\n        status: 'NEW',\r\n        events: {\r\n          create: {\r\n            eventType: 'ORDER_CREATED',\r\n            message: 'Order placed by user',\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return { success: true, orderCode: order.orderCode, packageName: pkg.name };\r\n  } catch (error) {\r\n    console.error('Failed to create order:', error);\r\n    return { success: false, error: 'Terjadi kesalahan sistem.' };\r\n  }\r\n}\r\n\r\nexport async function getAdminOrders() {\r\n  try {\r\n    const orders = await prisma.order.findMany({\r\n      orderBy: { createdAt: 'desc' },\r\n      take: 100,\r\n      include: { package: { select: { name: true, category: true } } },\r\n    });\r\n    return orders;\r\n  } catch (error) {\r\n    console.error('Failed to fetch admin orders:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport async function updateOrderStatus(\r\n  orderId: string,\r\n  newStatus: 'NEW' | 'CONFIRMED' | 'DONE' | 'CANCELED'\r\n) {\r\n  try {\r\n    await prisma.order.update({\r\n      where: { id: orderId },\r\n      data: { status: newStatus },\r\n    });\r\n    await prisma.orderEvent.create({\r\n      data: {\r\n        orderId,\r\n        eventType: 'STATUS_UPDATED',\r\n        message: `Status diubah menjadi ${newStatus}`,\r\n      },\r\n    });\r\n    revalidatePath('/admin');\r\n    revalidatePath('/admin/orders');\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Failed to update status:', error);\r\n    return { success: false, error: 'Gagal mengupdate status' };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;AAEA;AACA;;;;;AAEO,eAAe,YAAY,IAQjC;IACC,IAAI;QACF,yCAAyC;QACzC,MAAM,MAAM,MAAM,sJAAM,CAAC,OAAO,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE,IAAI,KAAK,SAAS;YAAC;QAAE;QAC5E,IAAI,CAAC,KAAK,OAAO;YAAE,SAAS;YAAO,OAAO;QAAyB;QACnE,IAAI,CAAC,IAAI,QAAQ,EAAE,OAAO;YAAE,SAAS;YAAO,OAAO;QAAqB;QACxE,IAAI,IAAI,KAAK,IAAI,GAAG,OAAO;YAAE,SAAS;YAAO,OAAO;QAAc;QAElE,+CAA+C;QAC/C,MAAM,OAAO,IAAI,OAAO,WAAW;QACnC,MAAM,MAAM,KAAK,KAAK,CAAC,OAAO,KAAK,MAAM,KAAK;QAC9C,MAAM,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,EAAE,KAAK;QAErC,4BAA4B;QAC5B,MAAM,QAAQ,MAAM,sJAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACtC,MAAM;gBACJ;gBACA,WAAW,KAAK,SAAS;gBACzB,UAAU,KAAK,QAAQ;gBACvB,QAAQ,KAAK,MAAM;gBACnB,UAAU,KAAK,QAAQ;gBACvB,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,UAAU,KAAK,QAAQ;gBACvB,QAAQ;gBACR,QAAQ;oBACN,QAAQ;wBACN,WAAW;wBACX,SAAS;oBACX;gBACF;YACF;QACF;QAEA,OAAO;YAAE,SAAS;YAAM,WAAW,MAAM,SAAS;YAAE,aAAa,IAAI,IAAI;QAAC;IAC5E,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO;YAAE,SAAS;YAAO,OAAO;QAA4B;IAC9D;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,sJAAM,CAAC,KAAK,CAAC,QAAQ,CAAC;YACzC,SAAS;gBAAE,WAAW;YAAO;YAC7B,MAAM;YACN,SAAS;gBAAE,SAAS;oBAAE,QAAQ;wBAAE,MAAM;wBAAM,UAAU;oBAAK;gBAAE;YAAE;QACjE;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,EAAE;IACX;AACF;AAEO,eAAe,kBACpB,OAAe,EACf,SAAoD;IAEpD,IAAI;QACF,MAAM,sJAAM,CAAC,KAAK,CAAC,MAAM,CAAC;YACxB,OAAO;gBAAE,IAAI;YAAQ;YACrB,MAAM;gBAAE,QAAQ;YAAU;QAC5B;QACA,MAAM,sJAAM,CAAC,UAAU,CAAC,MAAM,CAAC;YAC7B,MAAM;gBACJ;gBACA,WAAW;gBACX,SAAS,CAAC,sBAAsB,EAAE,WAAW;YAC/C;QACF;QACA,IAAA,+IAAc,EAAC;QACf,IAAA,+IAAc,EAAC;QACf,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO;YAAE,SAAS;YAAO,OAAO;QAA0B;IAC5D;AACF;;;IAtFsB;IAiDA;IAcA;;AA/DA,+OAAA;AAiDA,+OAAA;AAcA,+OAAA"}},
    {"offset": {"line": 369, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/dwiya/.gemini/antigravity/scratch/toro-store-app/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAdminPackages as '007553d70657ea6dc5926b6626805f9a2294588cb3'} from 'ACTIONS_MODULE0'\nexport {getPackages as '008ecafce8f37a15e09ef30285060694aa0314d6ed'} from 'ACTIONS_MODULE0'\nexport {uploadPackageImage as '403a9f53378900700b7503964c4cafa2f476b79d5e'} from 'ACTIONS_MODULE0'\nexport {createPackage as '407db269caab83b53d8250910ec3d4d6e35493915f'} from 'ACTIONS_MODULE0'\nexport {deletePackage as '40f16dadcfae0bf679dbb69d50543482e9fb054b4f'} from 'ACTIONS_MODULE0'\nexport {getPackageById as '40f4f4146cd83415bebeb3f517dc6d4627eaeb8968'} from 'ACTIONS_MODULE0'\nexport {updatePackage as '6029374c54c1d2c90afebf9ef02b1f378482fc4c3d'} from 'ACTIONS_MODULE0'\nexport {createOrder as '406c58de2a8d107d69f717d1ea428917143219f5a2'} from 'ACTIONS_MODULE1'\nexport {getPackages as '008ecafce8f37a15e09ef30285060694aa0314d6ed'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA;AAOA"}}]
}